# client setup

client:
  name: Example # not used yet
  timezone: America/Chicago # currently used by adapter jobboss driver and meter availability.js

# adapter service reads this section to know what devices to poll/subscribe to.
adapter:
  devices:
    - id: m # must match id in agent.xml
      name: Micro # this must match name in agent.cfg and agent.xml
      # see also device alias in relay section
      # sources define the inputs to the cache.
      sources:
        - module: micro # module defines inputs and outputs with yaml files
          driver: micro # adapter plugin - manages protocol and payload
      # where agent will connect to adapter
      connection:
        host: adapter # must match agent.cfg value
        port: 7890 # must match agent.cfg value

# relay service reads this section to know what agents and devices to read data from.
# can specify retention periods for data for agent, device, or dataitems - 1wk minimum.
# would clear all unneeded data weekly - then vacuum analyze db.
# warning: don't change the agent aliases (eg main) as they are used to synch data with db.
relay:
  retention: 1wk # can specify retention period for ALL agents here
  agents:
    - alias: Main # this is an identifier for the agent, used by the db - don't change once set!
      url: http://agent:5000 # url to the agent
      retention: 1wk # set agent retention period - overrides relay retention value
      # ignore: true # can specify this to turn agent recording on/off for all devices.
      devices:
        - id: m # must match id in agent.xml
          alias: Micro # used in path expressions - no spaces - use underscore if needed
          retention: 1wk # set device retention period - overrides agent retention value
          # ignore: true # specify this to turn device recording on/off
          # could translate, ignore, or set retention for individual dataitems
          dataitems:
            - id: m-cpu
              retention: 1wk # set dataitem retention period - overrides device retention value
              # ignore: true # overrides device ignore value
              # pathstep: CpuFoo # optional path translation

    - alias: Mazak5701 # this is an identifier for the agent, used by the db - don't change once set!
      url: http://mtconnect.mazakcorp.com:5701 # url to the agent
      # retention: 1y # override relay retention value
      # ignore: true # override relay ignore value
      devices:
        - id: d1 # must match id in agent.xml
          alias: Mill12345 # used in path expressions - no spaces!
          # ignore: true # override agent ignore value
          # retention: 1y # override agent retention value
          # dataitems:
          #   - id: d1-Cload
          #     pathstep: Load[Index]
          #   - id: d1-Sload
          #     pathstep: Load[Spindle]
          #   - id: d1-auto_time
          #     ignore: true
          #   - id: d1-total_time
          #     ignore: true
          #   - id: d1-cut_time
          #     ignore: true
          #   - id: d1-total_auto_cut_time
          #     ignore: true

# meter service reads this section, AND the relay section for list of agents and devices.
meter:
  defaults:
    # availability.js plugin defaults
    # gets active = time machine was active in previous time period,
    # based on part count changes,
    # and available = time is within start/stop schedule.
    # note that times have NO Z, ie they're purely local times, as obtained from jobboss.
    availability:
      activePath: Controller/AccumulatedTimeCut # acctimeAuto has auto incrementing time
      # # get start and stop times from xml, which could be set by jobboss driver
      # startPath: Processes/Shift/ProcessTimeStart # eg '2022-01-27T05:00:00'
      # stopPath: Processes/Shift/ProcessTimeComplete # eg '2022-01-27T13:30:00'
      # or set manual times
      # this could get very complex - just keep it simple for now
      startTime: '05:00:00'
      stopTime: '13:30:00'

    # # count.js plugin defaults
    # # accumulates count deltas into the lifetime count
    # count:
    #   deltaPath: Processes/Job/PartCountAll
    #   lifetimePath: Processes/Life/PartCountAll

    # # rate.js plugin defaults
    # # calculates the rate of change between counts, ie the production rate.
    # #. not finished yet
    # rate:
    #   valuePath: Processes/Life/PartCountAll
    #.   ratePath: controller/PartOccurrence/PartCountRate

  # set overrides per agentAlias/deviceAlias/meter here
  overrides:
    Main/Micro:
      availability:
        ignore: true
