version: '3.7'

services:
  portainer:
    container_name: portainer
    image: portainer/portainer-ce
    restart: always
    networks:
      - ladder99
    ports:
      - '9000:9000'
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    logging:
      driver: 'none'

  broker:
    container_name: broker
    build:
      context: .
      dockerfile: docker/broker/Dockerfile
    volumes:
      - ./etc/broker:/etc/broker
      - ./data/broker:/var/lib/broker
    networks:
      - ladder99

  adapter:
    container_name: adapter
    build:
      context: .
      dockerfile: docker/adapter/Dockerfile
    volumes:
      - ./etc/adapter:/etc/mtconnect/adapter
      - ./data/adapter:/var/lib/adapter
    networks:
      - ladder99
    depends_on:
      broker:
        condition: service_started

  agent:
    container_name: agent
    image: raymondhub/mtconnect:v1.5
    ports:
      - 5000:5000
    volumes:
      - ./etc/agent:/etc/mtconnect/agent
      - ./data/agent:/var/lib/agent
    command: 'agent debug /etc/mtconnect/agent/agent.cfg'
    networks:
      - ladder99

  # client:
  #   build:
  #     context: .
  #     dockerfile: docker/client/Dockerfile
  #   ports:
  #     - 8080:80
  #   environment:
  #     - NGINX_PORT=80
  #     - SERVER_HOST=server
  #     - SERVER_PORT=80

  # server:
  #   build:
  #     context: .
  #     dockerfile: docker/server/Dockerfile
  #   ports:
  #     - 3000:80
  #   environment:
  #     - PORT=80
  #     - MQTT_PORT=1883
  #     - MQTT_HOST=mosquitto

  # influx:
  #   image: influxdb
  #   ports:
  #     - 8086:8086
  #     - 2003:2003
  #   volumes:
  #     - ./etc/influxdb/influxdb.conf:/etc/influxdb/influxdb.conf
  #     - ./data/influx:/var/lib/influxdb

  # telegraf:
  #   image: telegraf
  #   volumes:
  #     - ./etc/telegraf:/etc/telegraf

  # chronograf:
  #   image: chronograf
  #   ports:
  #     - 8888:8888
  #   volumes:
  #     - ./data/chronograf:/var/lib/chronograf

  # kapacitor:
  #   image: kapacitor
  #   ports:
  #     - 9092:9092
  #   volumes:
  #     - ./etc/kapacitor/kapacitor.conf:/etc/kapacitor/kapacitor.conf
  #     - ./data/kapacitor:/var/lib/kapacitor
  #     - ./etc/kapacitor/load:/etc/kapacitor/load

  # mosquitto:
  #   image: eclipse-mosquitto
  #   ports:
  #     - 1883:1883
  #     - 9001:9001
  #   volumes:
  #     - ./etc/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf
  #     - ./data/mosquitto:/mosquitto/data
  #     - ./var/log/mosquitto:/mosquitto/log

volumes:
  portainer_data:
  mosquitto_config:
  mosquitto_data:
  mosquitto_log:
  nginx_conf:
  influx_data:
  influx_conf:
  chronograf_data:
  telegraf_conf:
  l99_loi_html:
  l99_plc_volume1:

networks:
  ladder99:
    name: ladder99
