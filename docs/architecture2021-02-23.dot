digraph "ladder99-adapter" {

  // styles
  graph [ label="Ladder99 MTConnect data flow"; color=lightgray; ];
  graph [ labelloc=t ];
  graph [ ranksep=0.1 ];
  graph [ rankdir=LR; ] // left-to-right
  node [ color=lightgray; fillcolor=white; style=filled ];
  edge [ color=lightgray, fontcolor=gray ];

  // nodes
  PLC1 [ fillcolor=lavender; label="Old Machine" ];
  PLC2 [ fillcolor=lavender; label="New Machine" ];
  PLC4X [ label="PLC4X\n(Java)" ];
  Broker [ label="MQTT Broker\n(NodeJS)" ];
  Adapter [ fillcolor=lightblue; label="MTConnect\nAdapter\n(NodeJS)" ];
  Diode [ label="Data Diode\n(NodeJS)" ];
  Agent [ fillcolor=lightblue; label="MTConnect\nAgent\n(C++)" ];
  Application [ fillcolor=lightblue; label="MTConnect\nApplication\n(NodeJS)" ];
  Database [ label="Database\n(InfluxDB/TimescaleDB)" ];
  Visualizer [ label="Visualizer\n(Grafana/Superset)" ];
  Cloud [ label="Cloud Storage\n(AWS/GCP)" ];
  Admin [ fillcolor=lightyellow ];
  // LOI [ label="LOI\n(SvelteJS)" ];
  // Operator [ fillcolor=lightyellow ];

  // edges
  PLC2 -> Broker [ label="  JSON/\nMQTT  " ];
  PLC1 -> PLC4X [ label="  proprietary\nprotocol" ];
  PLC4X -> Broker [ label="  JSON/  \nMQTT  " ];
  Broker -> Adapter [ label="  JSON/  \nMQTT  " ];
  Adapter -> Diode [ label="  SHDR/  \nUDP  " ];
  Diode -> Agent [ label="  SHDR/  \nTCP  " ];
  Agent -> Application [ label="  XML/  \nHTTP  " ];
  Application -> Agent [ label="  HTTP" ];
  Application -> Database;
  Database -> Visualizer;
  Database -> Cloud;
  Visualizer -> Admin;
  // Application -> LOI;
  // LOI -> Operator;

  // rank
  { rank=same; PLC1 PLC2 };
  // { rank=same; PLC4X Broker };
  { rank=same; PLC4X Broker Adapter Diode Agent };
  // { rank=same; Operator Admin Cloud };
  // { rank=same; Admin Cloud };
  { rank=same; Application Database Visualizer };

  // subgraphs
  // subgraph cluster1a {
  //   graph [ label="New Machine" ];
  //   PLC2;
  // }
  // subgraph cluster1b {
  //   graph [ label="Old Machine" ];
  //   PLC1;
  // }
  // subgraph cluster2 {
  //   graph [ label="Raspberry Pi 1" ];
  //   PLC4X;
  //   Broker;
  //   Adapter;
  //   Diode;
  //   Agent;
  //   // { rank=same; Diode Agent };
  // }
  // subgraph cluster4 {
  //   graph [ label="Raspberry Pi 2" ];
  //   Application;
  //   Database;
  //   Visualizer;
  //   // LOI;
  //   // { rank=same; Application Database Visualizer };
  // }
}
