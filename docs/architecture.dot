digraph "ladder99-adapter" {

  // styles
  graph [ label="Ladder99 MTConnect data flow\n "; color=lightgray; ];
  graph [ fontsize=20 ];
  graph [ labelloc=t ];
  graph [ ranksep=0.2 ];
  graph [ nodesep=0.35 ];
  graph [ rankdir=LR; ] // left-to-right
  node [ color=lightgray; fillcolor=white; style=filled ];
  edge [ color=gray85 ];
  edge [ fontsize=12; fontcolor=gray40; ];

  // nodes
  OldMachine [ fillcolor=lavender; label="Old Machine" ];
  NewMachine [ fillcolor=lavender; label="New Machine" ];
  PLC4X [ label="PLC4X\n(Java)" ];
  Broker1 [ label="MQTT Broker 1\n(Mosquitto)" ];
  Broker2 [ label="MQTT Broker 2\n(Mosquitto)" ];
  Adapter [ fillcolor=white; label="MTConnect\nAdapter\n(NodeJS)" ];
  DevicesYaml [ label="devices.yaml" ];
  DiodeSender [ label="Diode Sender\n(Java+RabbitMQ)" ];
  DiodeReceiver [ label="Diode Receiver\n(Java+RabbitMQ)" ];
  Agent [ fillcolor=white; label="MTConnect\nAgent\n(C++/cppagent)" ];
  DevicesXml [ label="devices.xml" ];
  Application [ fillcolor=white; label="MTConnect\nApplication\n(NodeJS)" ];
  Database [ label="Database\n(InfluxDB/\nTimescaleDB)" ];
  Visualizer [ label="Visualizer\n(Grafana/\nSuperset)" ];
  Cloud [ label="Cloud Storage\n(AWS/GCP)" ];
  Admin [ fillcolor=lightyellow ];
  // LOI [ label="LOI\n(SvelteJS)" ];
  // Operator [ fillcolor=lightyellow ];

  // edges
  OldMachine -> PLC4X [ label="proprietary\nprotocol" ];
  PLC4X -> Broker1 [ label="JSON / \nMQTT" ];
  NewMachine -> Broker2 [ label="JSON / \nMQTT" ];
  Broker1 -> Adapter [ label="JSON /    \nMQTT 1883           " ];
  Broker2 -> Adapter [ label="JSON /    \nMQTT 1883           " ];
  Adapter -> DiodeSender [ label="SHDR /   \nTCP 7878      " ];
  DevicesYaml -> Adapter [ ];
  DevicesYaml -> DevicesXml [ ];
  DiodeSender -> DiodeReceiver [ label="UDP    " ];
  DiodeReceiver -> Agent [ label="SHDR /   \nTCP  " ];
  // Adapter -> Agent [ label="SHDR/\nTCP 7878" ];
  Agent -> Application [ dir=both; label="XML /\nHTTP 5000" ];
  DevicesXml -> Agent [ label="used by" ];
  Application -> Database [ dir=both ];
  Database -> Visualizer [ dir=both ];
  Database -> Cloud;
  Visualizer -> Admin [ dir=both ];
  // Application -> LOI;
  // LOI -> Operator;

  // rank
  { rank=same; OldMachine NewMachine };
  { rank=same; Broker1 Broker2 };
  // { rank=same; DevicesYaml DevicesXml };
  // { rank=same; PLC4X Broker Adapter DiodeSender DiodeReceiver Agent Application Database Visualizer };
  { rank=same; Adapter DiodeSender DiodeReceiver Agent Application Database Visualizer };
}
