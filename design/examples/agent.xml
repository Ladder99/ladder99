<?xml version="1.0" encoding="UTF-8"?>

<MTConnectDevices xmlns:m="urn:mtconnect.org:MTConnectDevices:1.7" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:mtconnect.org:MTConnectDevices:1.7" xsi:schemaLocation="urn:mtconnect.org:MTConnectDevices:1.7 https://schemas.mtconnect.org/schemas/MTConnectDevices_1.7.xsd">
  <Header creationTime="2021-09-20T00:00:00+00:00" deviceModelChangeTime="2021-09-20T00:00:00+00:00" sender="localhost" instanceId="12345678" bufferSize="131072" assetBufferSize="1000" assetCount="0" version="1.7.0.3" />
  <Devices>

    <Device id="pr1" name="ZT410" uuid="18J161604846" sampleInterval="1000">
      <DataItems>
        <DataItem category="EVENT" id="pr1-avail" name="availability" type="AVAILABILITY" />
      </DataItems>
      <Components>

        <Controller id="pr1-controller" name="controller">
          <DataItems>
            <DataItem category="EVENT" id="pr1-msg" name="message" type="MESSAGE" />
            <DataItem category="CONDITION" id="pr1-cond" name="condition" type="SYSTEM" />
          </DataItems>

          <Components>
            <Path id="pr1-path" name="pr1-path">
              <DataItems>
                <DataItem category="EVENT" id="pr1-state" name="execution_state" type="EXECUTION" />

                <!-- odometer.total_label_count -->
                <DataItem category="SAMPLE" id="pr1-uc" name="total_output" type="UNLOAD_COUNT" />

                <!-- labels remaining -->
                <DataItem category="SAMPLE" id="pr1-lr" name="labels_remaining" type="PART_COUNT" subType="REMAINING" />

                <!-- odometer.total_print_length -->
                <DataItem category="SAMPLE" id="pr1-tl" name="total_length" type="POSITION" subType="ACTUAL" units="MILLIMETER" nativeUnits="INCH" />

                <!-- media.speed -->
                <DataItem category="SAMPLE" id="pr1-fr" name="feed_rate" type="PATH_FEEDRATE" subType="PROGRAMMED" units="MILLIMETER/SECOND" nativeUnits="INCH/SECOND" />

                <!-- print.tone -->
                <!-- type=x:DARKNESS? -->
                <DataItem category="EVENT" id="pr1-dark" name="darkness" type="VARIABLE" />

                <!-- sensor.head.temp_celsius -->
                <DataItem category="SAMPLE" id="pr1-ht" name="head_temp" type="TEMPERATURE" subType="ACTUAL" units="CELSIUS" />
              </DataItems>
            </Path>
          </Components>
        </Controller>
      </Components>
    </Device>

    <!-- interval is in msec -->
    <Device id="kl1" name="kl1" uuid="kl1" sampleInterval="1000">
      <DataItems>
        <DataItem category="EVENT" id="kl1-avail" name="availability" type="AVAILABILITY" />
        <DataItem category="EVENT" id="kl1-func" name="functional_mode" type="FUNCTIONAL_MODE" />
        <DataItem category="EVENT" id="kl1-chg" name="asset_changed" type="ASSET_CHANGED" />
        <DataItem category="EVENT" id="kl1-rem" name="asset_removed" type="ASSET_REMOVED" />
      </DataItems>
      <Components>
        <Controller id="kl1-controller" name="kl1-controller">
          <DataItems>
            <DataItem category="EVENT" id="kl1-exec" name="execution_state" type="EXECUTION" />
            <DataItem category="EVENT" id="kl1-wait" name="wait_state" type="WAIT_STATE" />
            <DataItem category="EVENT" id="kl1-emp" name="power" type="EQUIPMENT_MODE" subType="POWERED" />
            <DataItem category="EVENT" id="kl1-ctl_pgm" name="control_program" type="PROGRAM" subType="MAIN" />
            <DataItem category="EVENT" id="kl1-step" name="step" type="BLOCK" />
            <DataItem category="SAMPLE" id="kl1-clk_time" name="clock_time" type="CLOCK_TIME" />
            <DataItem category="SAMPLE" id="kl1-up" name="up_time" type="EQUIPMENT_TIMER" subType="OPERATING" />
            <DataItem category="EVENT" id="kl1-fw" name="build_no" type="FIRMWARE" subType="VERSION" />
            <DataItem category="EVENT" id="kl1-msg" name="message" type="MESSAGE" />
            <!-- no faults? -->
            <DataItem category="CONDITION" id="kl1-cond" name="condition" type="SYSTEM" />
          </DataItems>
          <Components>
            <ProcessOccurrence id="kl1-process_occurrence" name="process_occurrence">
              <DataItems>
                <!-- NIS Process Flow -->
                <!-- https://drive.google.com/file/d/1XDF57PkqumzVb9MdMSdV0UxtTG8LqD8W/view?usp=sharing -->
                <!-- https://drive.google.com/file/d/14XRzAv6XFJrQZjSgU8ka-AhzUrYQtRge/view?usp=sharing -->

                <!-- PROCESS_OCCURRENCE_ID MUST be defined for PartOccurrence -->
                <!-- uuid per job, uuid changes when job changes -->
                <!-- generate one -->
                <DataItem category="EVENT" id="kl1-poid" name="job_uuid" type="PROCESS_OCCURRENCE_ID" />

                <!-- sales order number from kit label %Z61.0.sales_order_number (current job metadata) -->
                <!-- TODO: ChrisE needs to modify regex to pull order number from ZPL -->
                <DataItem category="EVENT" id="kl1-salesord" name="sales_order" type="PROCESS_AGGREGATE_ID" subType="ORDER_NUMBER" />

                <!-- purchase order number from skid label %Z61.x.purchase_order_number (current job metadata) -->
                <!-- TODO: ChrisE needs to modify regex to pull order number from ZPL -->
                <DataItem category="EVENT" id="kl1-purchord" name="purchase_order" type="PROCESS_AGGREGATE_ID" subType="ORDER_NUMBER" />

                <!-- always the string "KITTING" -->
                <DataItem category="EVENT" id="kl1-procname" name="process_name" type="PROCESS_KIND_ID" subType="PROCESS_NAME" />

                <!-- job starts when user moves blue square to green square, change on any values in %Z61 (current job) map -->
                <DataItem category="EVENT" id="kl1-start" name="start_time" type="PROCESS_TIME" subType="START" />

                <!-- sequence: -->
                <!-- %Z61.3 = TRUE 
                                    (current job done, sensor 1 decremented %Z61.2 (current job part countdown) to 0) 
                                    and %Z61.6 change -->
                <!-- TODO: ChrisE needs to review when job done is set. could it be set on sensor 2? -->
                <!-- some edge cases here that need testing: jobs are forcefully cleared from controller, 
                                    job short run and user move next job into position, etc -->
                <DataItem category="EVENT" id="kl1-complete" name="complete_time" type="PROCESS_TIME" subType="COMPLETE" />

                <!-- derive from job part count, parts complete, avg cycle time, etc -->
                <DataItem category="EVENT" id="kl1-target" name="target_completion" type="PROCESS_TIME" subType="TARGET_COMPLETION" />

                <!-- match PartOccurence.PART_KIND_ID.UUID -->
                <DataItem category="EVENT" id="kl1-pkuuidref" name="pkuuid_ref" type="PART_KIND_ID" subType="UUID" />

                <!-- The Valid Data Value MUST be INITIALIZING, READY, ACTIVE, COMPLETE, INTERRUPTED, or ABORTED. -->
                <!-- READY - job put into current position (green square) -->
                <!-- ACTIVE - first part counted by sensor 1 -->
                <!-- COMPLETED - last part counted by sensor 2 -->
                <!-- schema bug? says process_state invalid -->
                <DataItem category="EVENT" id="kl1-procstate" name="process_state" type="PROCESS_STATE" />

                <!-- current active program from PLC /status topic "pgm1004" -->
                <DataItem category="EVENT" id="kl1-pgm" name="program" type="PROGRAM" subType="MAIN" />

                <!-- Cycle Time -->
                <DataItem category="SAMPLE" id="kl1-cycle" name="cycle_time" type="PROCESS_TIMER" subType="PROCESS" />
                <DataItem category="SAMPLE" id="kl1-cycleavg" name="cycle_time_avg" type="PROCESS_TIMER" subType="PROCESS" statistic="AVERAGE" />
                <DataItem category="EVENT" id="kl1-cycles" name="cycle_times" type="PROCESS_TIMER" representation="DATA_SET" />
                <DataItem category="EVENT" id="kl1-tremain" name="time_remaining" type="VARIABLE" />

                <!--<DataItem category="EVENT" id="" name="" type="PROCESS_AGGREGATE_ID" subType="PROCESS_STEP"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PROCESS_AGGREGATE_ID" subType="PROCESS_PLAN"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="PROCESS_KIND_ID" subType="UUID"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PROCESS_KIND_ID" subType="ISO_STEP_EXECUTABLE"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="USER" subType="MAINTENANCE"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="USER" subType="OPERATOR"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="USER" subType="SETUP"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="PROGRAM" subType="SCHEDULE"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PROGRAM" subType="ACTIVE"/>-->
              </DataItems>
            </ProcessOccurrence>

            <PartOccurrence id="kl1-part_occurrence" name="kl1-part_occurrence">
              <DataItems>
                <!-- PART_ID MUST be defined for PartOccurrence. -->
                <DataItem category="EVENT" id="kl1-pid" name="part_id" type="PART_ID" />

                <!-- match ProcessOccurence.PROCESS_OCCURENCE_ID -->
                <!-- generate uuid -->
                <DataItem category="EVENT" id="kl1-poidref" name="process_occurrence_id_ref" type="PROCESS_OCCURRENCE_ID" />

                <!-- uuid per job, uuid changes when job changes -->
                <!-- primary key to part occurrence -->
                <DataItem category="EVENT" id="kl1-pkuuid" name="pkuuid" type="PART_KIND_ID" subType="UUID" />

                <!-- part number from kit label %Z61.0.kit_number (current job metadata) -->
                <DataItem category="EVENT" id="kl1-pknum" name="pknum" type="PART_KIND_ID" subType="PART_NUMBER" />

                <!-- part name from kit label %Z61.0.kit_name (current job metadata) -->
                <DataItem category="EVENT" id="kl1-pkname" name="pkname" type="PART_KIND_ID" subType="PART_NAME" />

                <!-- assembled on date from kit label %Z61.0.assembled_date (current job metadata) -->
                <!-- TODO: ChrisE needs to modify regex to pull assy date from ZPL -->
                <DataItem category="EVENT" id="kl1-dc" name="date_code" type="DATE_CODE" subType="MANUFACTURE" />

                <!-- parts counted (we are unable to distinguish good from bad -->
                <!-- pcall would be eye2 count -->
                <DataItem category="SAMPLE" id="kl1-pcall" name="pcall" type="PART_COUNT" subType="ALL" />

                <!-- total parts -->
                <!-- TARGET -->
                <!-- count from kit label %Z61.0.carton_quantity (current job metadata) -->
                <!-- pctarget comes from the data sent from client, it is constant for the job -->
                <DataItem category="SAMPLE" id="kl1-pctarg" name="pctarget" type="PART_COUNT" subType="TARGET" />

                <!-- parts complete -->
                <!-- ALL -->
                <DataItem category="SAMPLE" id="kl1-pccomp" name="pccomplete" type="PART_COUNT" subType="COMPLETE" />

                <!-- parts remaining - these 3 values should be consistent -->
                <!-- REMAINING = TARGET minus ALL -->
                <!-- <DataItem category="SAMPLE" id="kl1-pcrem_calc" name="pcremaining_calc" type="PART_COUNT" subType="REMAINING" /> -->
                <!-- <DataItem category="SAMPLE" id="kl1-pcrem_plc" name="pcremaining_plc" type="PART_COUNT" subType="REMAINING" /> -->
                <!-- <DataItem category="SAMPLE" id="kl1-pcrem_pr" name="pcremaining_printer" type="PART_COUNT" subType="REMAINING" /> -->

                <!-- use x: to make these unique for db? -->
                <DataItem category="SAMPLE" id="kl1-pcrem_calc" name="pcremaining_calc" type="PART_COUNT" subType="x:REMAINING_CALC" />
                <DataItem category="SAMPLE" id="kl1-pcrem_plc" name="pcremaining_plc" type="PART_COUNT" subType="x:REMAINING_PLC" />
                <DataItem category="SAMPLE" id="kl1-pcrem_pr" name="pcremaining_printer" type="PART_COUNT" subType="x:REMAINING_PR" />

                <!--<DataItem category="EVENT" id="" name="" type="PART_UNIQUE_ID" subType="UUID"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_UNIQUE_ID" subType="UUID"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_UNIQUE_ID" subType="SERIAL_NUMBER"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_UNIQUE_ID" subType="RAW_MATERIAL"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="PART_GROUP_ID" subType="UUID"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_GROUP_ID" subType="LOT"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_GROUP_ID" subType="BATCH"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_GROUP_ID" subType="RAW_MATERIAL"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_GROUP_ID" subType="HEAT_TREAT"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="PART_COUNT" subType="BAD"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_COUNT" subType="GOOD"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_COUNT" subType="FAILED"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PART_COUNT" subType="ABORTED"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="PART_STATUS"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="PROCESS_TIME" subType="START"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PROCESS_TIME" subType="COMPLETE"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="PROCESS_TIME" subType="TARGET_COMPLETION"/>-->

                <!--<DataItem category="EVENT" id="" name="" type="USER" subType="MAINTENANCE"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="USER" subType="OPERATOR"/>-->
                <!--<DataItem category="EVENT" id="" name="" type="USER" subType="SETUP"/>-->
              </DataItems>
            </PartOccurrence>
          </Components>
        </Controller>
      </Components>
    </Device>
  </Devices>
</MTConnectDevices>