# inputs.yaml
# inputs are unique data sources to manage data collection and pre-processing
inputs:
  - ccs-mqtt-1: &ccs-mqtt-1
    # type of plugin - manages protocol and payload
    type: mqtt-ccs
    # should this data source be initialized on adapter startup?
    active: true
    # plugin specific configuration
    configuration:
      url: "mqtt://broker1:1883"
      user: ...
      pass: ...
      tls: false
    # cache items are unknown

  - autoclaveB4433: &autoclaveB4433
    type: cpc
    active: true
    configuration:
      primary:
        ip: 192.168.2.2
        port: 9999
        poll: 5
      secondary:
        ip: 192.168.2.3
        port: 9999
        poll: 5
    # data items to retrieve from data source
    tags:
      # data item alias
      B4433-air_tc:
        # data item path
        path: .Autoclave.AIR_TC\Value
        # batching allows req-resp protocols to limit
        # the number of data items per request
        batch: 1
      B4433-temp_alarm:
        path: .Autoclave.Alarms.OverTemp\Active
        batch: 1

  - kepware1: &kepware1
    type: kepware-opc
    active: true
    configuration:
      connection: ...
      poll: 5
    tags:
      B4433-motion-alarm:
        path: "ns=1;B3:5"
      B7744-motion-alarm:
        path: "ns=1;B7:4"

  - kepware2: &kepware2
    type: kepware-opc
    active: true
    configuration:
      connection: ...
      poll: 5
    tags:
      B4433-operator_id:
        path: "ns=1;B3:5"
      B4433-operator_name:
        path: "ns=1;B7:4"

# outputs.yaml
# outputs are unique outputs of post-processed data
outputs:
  - adapter1-7878: &adapter1-7878
    type: shdr
    configuration:
      host: adapter1
      port: 7878

  - adapter1-7879: &adapter1-7879
    type: shdr
    configuration:
      host: adapter1
      port: 7879

  - adapter1-7880: &adapter1-7880
    type: shdr
    configuration:
      host: adapter1
      port: 7880

# devices.yaml
devices:
  - ccs-pa-001:
    model: ccs-pa
    properties:
      uuid: e05363af-95d1-4354-b749-8fbb09d3499e
      serialNumber: 1
    # referencing inputs per device seems unneccessary.
    # data from inputs will end up in cache,
    # maybe it is relevant if we want a specific device 
    # to react on data change?
    inputs:
      - *ccs-mqtt-1
    outputs:
      - *adapter1-7878

  - autoclave-with-a-bunch-of-stuff:
    model: model123
    properties:
      uuid: e05363af-95d1-4354-b749-8fbb09d3499e
      serialNumber: 1
    inputs:
      - *autoclaveB4433
      - *kepware1
      - *kepware2
    outputs:
      - *adapter1-7879

  - some-other-device:
    model: model456
    properties:
      uuid: e05363af-95d1-4354-b749-8fbb09d3499e
      serialNumber: 1
    inputs:
      - *kepware1
    outputs:
      - *adapter1-7880

# models\ccs-pa\model.yaml
model:
  - id: ${deviceId} # eg 'ccs-pa-001'
    name: CCS-PA
    uuid: ${uuid} # eg 'e05363af-95d1-4354-b749-8fbb09d3499e'
    sampleInterval: 10

    description:
      manufacturer: CCS
      model: Emergent-PA-Pneumatic
      serialNumber: ${serialNumber} # eg '001'
      text: Emergent Next Generation Print and Apply

    dataItems:
      dataItem:
        - connection
        - asset_changed
        - asset_removed
        - dev_cond
        - dev_msg
        - fw_ver

# models\ccs-pa\calcs.yaml
calcs:
  ...


# notes
autoclave-with-a-bunch-of-stuff calcs
  air_tc = cache.get('B4433-air_tc')
  temp_alarm = cache.get('B4433-temp_alarm')
  motion_alarm = cache.get('B4433-motion-alarm')
  operator_id = cache.get('B4433-operator_id')
  operator_name = cache.get('B4433-operator_name')

some-other-device calcs
  air_tc = cache.get('B7744-motion-alarm')
