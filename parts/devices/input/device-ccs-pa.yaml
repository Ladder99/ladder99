device:
  - id: ccs-pa
    name: CCS-PA
    uuid: '000'
    sampleInterval: 10

    description:
      manufacturer: CCS
      model: Emergent-PA-Pneumatic
      serialNumber: '000'
      text: Emergent Next Generation Print and Apply

    events:
      fw_ver: &fw_ver
        id: ccs-pa-fw_ver
        category: EVENT
        type: FIRMWARE
        subType: VERSION
        source: l99/ccs/evt/status+build_no

      state: &state
        id: ccs-pa-state
        category: EVENT
        type: EXECUTION
        # source: execution.lua
        docs: |
          EXECUTION
          The execution status of the Controller. 
          READY, ACTIVE, INTERRUPTED, FEED_HOLD, STOPPED, OPTIONAL_STOP, 
          PROGRAM_STOPPED, or PROGRAM_COMPLETED
          http://mtcup.org/wiki/Data_Item_Types:_EVENT
        # <Source>status.state 400 ACTIVE; 200 READY; 50,100,250,300 WAIT</Source>
        #. need more succinct code here - pattern matching lib?
        javascript: |
          function(cache) {
            const states = {
              50: 'WAIT',
              100: 'WAIT',
              200: 'PROGRAM_STOPPED',
              250: 'WAIT',
              300: 'WAIT',
              400: 'ACTIVE',
            }
            const msg = cache.getMsg('l99/ccs/evt/status')
            const stateValue = msg.state
            const stateName = states[stateValue]
            const shdr = `${msg.timestamp}|state|${stateName}`
            return shdr
          }

      wait_state: &wait_state
        id: ccs-pa-wait_state
        category: EVENT
        type: WAIT_STATE
        # source: wait_state.lua
        # <Source>status.state 50,100 PAUSING; 250,300 RESUMING; ?</Source>

      program: &program
        id: ccs-pa-program
        category: EVENT
        type: EXECUTION

      step: &step
        id: ccs-pa-step
        category: EVENT
        type: EXECUTION

      printer_start_print: &printer_start_print
        id: ccs-pa-%Q0.0
        name: printer_start_print
        category: EVENT
        type: ACTUATOR_STATE
        source: l99/ccs/evt/read+%Q0.0

      printer_feed: &printer_feed
        id: ccs-pa-%Q0.1
        name: printer_feed
        category: EVENT
        type: ACTUATOR_STATE
        source: l99/ccs/evt/read+%Q0.1

      printer_pause: &printer_pause
        id: ccs-pa-%Q0.2
        name: printer_pause
        category: EVENT
        type: ACTUATOR_STATE
        source: l99/ccs/evt/read+%Q0.2

    dataItems:
      dataItem:
        - *fw_ver
        - *printer_start_print
        - *printer_feed
        - *printer_pause

    components:
      controller:
        id: ccs-pa-controller
        nativeName: plc
        description:
          text: Electronic board set responsible for coordinating all machine function.
        dataItems:
          dataItem:
            - *state
            - *wait_state
            - *program
            - *step

        components:
          path:
            id: ccs-pa-path1
            name: path
            dataItems:
              dataItem: []

    systems:
      id: ccs-pa-systems
      components:
        endEffector:
          id: ccs-pa-end_effector
          dataItems:
            dataItem: []
          compositions: []
        feeder:
          id: ccs-pa-feeder
          dataItems:
            dataItem: []
          compositions: []
