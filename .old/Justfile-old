compile-xml SETUP='demo':
    node services/compiler/src/compileXml.js setups/{{SETUP}}/devices.yaml | \
    tee setups/{{SETUP}}/volumes/agent/devices.xml

# compile calcs.js from model outputs.yaml
compilejs SETUP='demo':
    for filename in setups/{{SETUP}}/devices/*.yaml; \
    do \
        node services/compiler/src/compileJs.js "$filename" | \
          tee "setups/demo/devices/$(basename $filename .yaml).js" ; \
    done
    cp services/compiler/output/*.js services/adapter/src/plugins


# # copy setup data and models to adapter folder
# copy-adapter-data SETUP='demo':
#     mkdir -p services/adapter/src/data
#     cp -r models services/adapter/src/data/models && \
#     cp setups/{{SETUP}}/devices.yaml services/adapter/src/data

# # remove data folder from adapter
# delete-adapter-data:
#     rm -rf services/adapter/src/data


# # copy setup data and models to agent folder, 
# # so it's in the context accessible by the dockerfile.
# copy-agent-data SETUP='demo':
#     mkdir -p services/agent/data
#     cp -r setups/{{SETUP}}/volumes/agent  services/agent/data

# # remove data folder from agent
# delete-agent-data:
#     rm -rf services/agent/data

